import{E as d}from"./Errors-C30A2Jtx-v4.6.0.js";Alpine.data("Addresses",({initialAddresses:e,initialDefaultAddress:r,countries:i})=>({addresses:e,defaultAddress:r,countries:i,formOpen:!1,editing:!1,loading:!1,form:{state:""},states:{},errors:new d,get firstCountry(){return Object.keys(this.countries)[0]},get hasAddress(){return Object.keys(this.addresses).length!==0},get hasNoStates(){return Object.keys(this.states).length===0},init(){this.changeCountry(this.firstCountry)},changeDefaultAddress(t){this.defaultAddress.address_id!==t.id&&(this.defaultAddress.address_id=t.id,axios.post(route("account.addresses.change_default"),{address_id:t.id}).then(s=>{notify(s.data)}).catch(s=>{notify(s.response.data.message)}))},changeCountry(t){this.form.country=t,this.form.state="",this.fetchStates(t)},async fetchStates(t,s){const a=await axios.get(route("countries.states.index",{code:t}));this.states=a.data,s&&s()},edit(t){this.formOpen=!0,this.editing=!0,this.$nextTick(()=>{this.form={...t},this.fetchStates(t.country,()=>{this.form.state="",this.$nextTick(()=>{this.form.state=t.state})})})},remove(t){confirm(trans("storefront::account.addresses.confirm"))&&axios.delete(route("account.addresses.destroy",t.id)).then(s=>{delete this.addresses[t.id],notify(s.data.message)}).catch(s=>{notify(s.response.data.message)})},cancel(){this.editing=!1,this.formOpen=!1,this.errors.reset(),this.resetForm()},save(){this.loading=!0,this.editing?this.update():this.create()},update(){axios.put(route("account.addresses.update",{id:this.form.id}),this.form).then(({data:t})=>{this.formOpen=!1,this.editing=!1,this.addresses[this.form.id]=t.address,this.resetForm(),notify(t.message)}).catch(({response:t})=>{t.status===422&&this.errors.record(t.data.errors),notify(t.data.message)}).finally(()=>{this.loading=!1})},create(){axios.post(route("account.addresses.store"),this.form).then(({data:t})=>{this.formOpen=!1;let s={[t.address.id]:t.address};this.addresses={...this.addresses,...s},this.resetForm(),notify(t.message)}).catch(({response:t})=>{t.status===422&&this.errors.record(t.data.errors),notify(t.data.message)}).finally(()=>{this.loading=!1})},resetForm(){this.form={state:""}}}));
